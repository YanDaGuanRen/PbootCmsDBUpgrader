# PBootCms 数据库迁移工具 1.0 ro 2.0 to 3.x (不服老,屎上雕花系列)

朋友公司的网站找了个网络公司做了个网站三天老头被黑,后来找人看了说版本太老了让升级以下,但又不是二开的没法正常升级,所以找到我让我帮他搞一下数据库所以写了这个脚本,稍微修改一下就可以把所有的数据库迁移到新的数据库我只写了数据量比较大的内容库,还有应该库很多not null字段的，所以我添加了默认值,用个sql删除一下就行。

## 项目结构

- `migrate_content.py`: 主要的迁移脚本，包含所有配置和迁移逻辑 这个只能同步content的数据库
- `integrated_script.py`:能同步整个数据库在里面设置好源库目标库和结果库就行 适合所有版本所有库转换

## 使用方法 integrated_script

1. 确保你的环境中已安装Python 3.x
2. 将源数据库文件命名为`pbootcms.db` 要转成什么样的数据库结构
3. 将目标数据库文件命名为`pbootcms1.db` 要转的数据
4. 运行脚本:
   ```
   python integrated_script.py
   ```
5. 脚本执行完毕后，会生成`target_backup.db`文件，其中包含了迁移后的数据库
6. 脚本还会在控制台输出表结构和记录数的比较结果

### 注意事项

1. 脚本会自动删除已存在的`target_backup.db`文件，然后重新生成
2. 对于`ay_content_ext`表，脚本会直接使用目标库的表结构和数据，忽略源库的内容
3. 脚本中的表结构比较是将结果库与源库进行比较，而不是与目标库比较，因此可能会出现"结构不一致"的提示，这并不一定表示结果库有错误
4. 如果需要修改数据库文件路径，可以在`integrated_script.py`文件中的`main`函数中修改相应的路径


## 使用方法 migrate_content

在`migrate_content.py`脚本中，有以下配置变量：

- `source_db_path`: 源数据库路径
- `target_db_path`: 目标数据库路径
- `csv_file`: 图片链接映射CSV文件路径
- `new_image_url`: 新图片URL前缀

1. 确保所有文件都在同一目录下
2. 根据需要修改`migrate_content.py`中的配置变量
3. 运行迁移脚本：
   ```
   python migrate_content.py
   ```

### 图片处理流程

1. 遍历源数据库内容表中的记录
2. 提取内容中的图片链接并生成映射关系
3. 根据配置替换图片链接
4. 将处理后的内容插入目标数据库
5. 生成图片链接映射CSV文件

### 注意事项

1. 迁移前请备份数据库文件
2. 根据实际需求调整配置参数
3. 迁移完成后检查目标数据库内容和图片链接是否正确
