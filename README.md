# PBootCms 数据库迁移工具 1.0 ro 2.0 to 3.x (不服老,屎上雕花系列)

朋友公司的网站找了个网络公司做了个网站三天老头被黑,后来找人看了说版本太老了让升级以下,但又不是二开的没法正常升级,所以找到我让我帮他搞一下数据库所以写了这个脚本,稍微修改一下就可以把所有的数据库迁移到新的数据库我只写了数据量比较大的内容库,还有应该库很多not null字段的，所以我添加了默认值,用个sql删除一下就行。
该工具用于将旧数据库（old.db）中的内容迁移到新数据库（nes.db）中，并处理其中的图片链接。

## 项目结构

- `migrate_content.py`: 主要的迁移脚本，包含所有配置和迁移逻辑
- `nes.db`: 目标数据库文件（新数据库）
- `old.db`: 源数据库文件（旧数据库）
- `image_links.csv`: 图片链接映射文件（CSV格式）

## 配置说明

在`migrate_content.py`脚本中，有以下配置变量：

- `source_db_path`: 源数据库路径
- `target_db_path`: 目标数据库路径
- `csv_file`: 图片链接映射CSV文件路径
- `new_image_url`: 新图片URL前缀

## 功能特性

1. **数据迁移**: 从源数据库迁移内容到目标数据库
2. **图片链接处理**: 自动记录和替换内容中的图片链接
3. **字段默认值处理**: 为新数据库中的非空字段添加默认值
4. **CSV映射文件生成**: 自动生成图片链接映射关系文件

## 使用方法

1. 确保所有文件都在同一目录下
2. 根据需要修改`migrate_content.py`中的配置变量
3. 运行迁移脚本：
   ```
   python migrate_content.py
   ```

## 数据库结构

两个数据库都包含以下主要表：

- `ay_area`: 地区表
- `ay_company`: 公司表
- `ay_config`: 配置表
- `ay_content`: 内容表（主要迁移对象）
- `ay_content_ext`: 内容扩展表
- `ay_label`: 标签表
- `ay_link`: 链接表
- `ay_member`: 会员表
- `ay_message`: 消息表
- `ay_model`: 模型表
- `ay_module`: 模块表
- `ay_role`: 角色表
- `ay_user`: 用户表

注意：新旧数据库在某些表的字段上存在差异，脚本会自动处理这些差异。

## 图片处理流程

1. 遍历源数据库内容表中的记录
2. 提取内容中的图片链接并生成映射关系
3. 根据配置替换图片链接
4. 将处理后的内容插入目标数据库
5. 生成图片链接映射CSV文件

## 注意事项

1. 迁移前请备份数据库文件
2. 根据实际需求调整配置参数
3. 迁移完成后检查目标数据库内容和图片链接是否正确
